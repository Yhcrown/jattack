/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java Library project to get you started.
 * For more details take a look at the Java Libraries chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.0.1/userguide/java_library_plugin.html
 */

plugins {
    id 'java-library'
    id 'com.github.johnrengelman.shadow' version '7.0.0'
}

group 'jattack'
version '0.84.15'

repositories {
    mavenCentral()
}

dependencies {
    implementation 'csutil:csutil'
    implementation 'com.github.javaparser:javaparser-core:3.25.0'
    implementation 'io.github.tudo-aqua:z3-turnkey:4.8.10'
    implementation 'org.ow2.asm:asm:9.4'
    implementation 'org.ow2.asm:asm-tree:9.4'
    testImplementation 'junit:junit:4.12'
}

java {
    sourceCompatibility = JavaVersion.VERSION_17
    targetCompatibility = JavaVersion.VERSION_17
}

// compileJava {
//     options.compilerArgs << '-Xlint:unchecked'
// }

jar {
    manifest {
        attributes('Manifest-Version': '1.0',
                   'Main-Class': 'jattack.driver.Driver',
                   'Implementation-Version': project.version,
                   'Premain-Class': 'jattack.compiler.Agent',
                   'Can-Redefine-Classes': 'true',
                   'Can-Retransform-Classes': 'true',
                   'Agent-Class': 'jattack.compiler.Agent'
        )
    }
}

shadowJar {
    // archiveBaseName.set('jattack') // default rootProject.name
    // archiveClassifier.set('nodeps') // default 'all'
    // archiveVersion.set('1.0') // default version
    relocate 'org.objectweb.asm', 'jattack.asm'
}

import com.github.jengelman.gradle.plugins.shadow.tasks.ShadowJar
task csutilJar(type: ShadowJar) {
    archiveClassifier.set("with-csutil")
    from sourceSets.main.output
    configurations = [project.configurations.compileClasspath]
    dependencies {
        // Include only csutil
        include(dependency('csutil:csutil'))
        include(dependency('org.ow2.asm:asm'))
        include(dependency('org.ow2.asm:asm-tree'))
        exclude('module-info.class')
        relocate('org.objectweb.asm', 'jattack.asm')
    }

    manifest {
        // Inherit manifest from jar task
        inheritFrom project.tasks.jar.manifest
    }
}
